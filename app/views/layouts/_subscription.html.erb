<%= subscribe_to "/messages/#{current_user.id}" if signed_in?%>
<script>
  PrivatePub.subscribe("/messages/<%= current_user.id %>", function(data, channel) {
    if (data.type == 1) onChatMessage(data.message);
    console.log(data);
  });
  (function poll(){
  setTimeout(function(){
    console.log("setTimeout");
    $.ajax({ 
      url: "http://localhost:3000/refresh", 
      type: "GET",
      dataType: "json",
      data: {"users": getUidsFromUserList()},
      success: function(data){
        tuids = data.uids;
        updateOnlineStatus(data.uids);  
        //Setup the next poll recursively
        poll();
      }});
    }, 10000);
  })();  
</script>
<%= online_users %>
